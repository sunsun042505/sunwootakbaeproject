<!doctype html><html lang="ko"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>선우택배</title><link rel="stylesheet" href="./style.css"></head>
<body><div class="wrap">
<div class="topbar">
  <div><div class="title">선우택배 (Netlify Blobs 서버저장)</div>
    <div class="sub">build 2025-12-31 14:20:46 KST · ⚠️ GitHub Pages 단독으론 서버가 없어서 불가 → Netlify로 배포해야 함</div></div>
  <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
    <span class="pill" id="clock">--:--:--</span>
    <button class="btn" onclick="location.href='./kiosk.html'">키오스크</button>
    <button class="btn" onclick="location.href='./tracking.html'">배송조회</button>
  </div>
</div>

<div class="card">
  <b>서버 연결 테스트</b>
  <div class="sub">여기서 OK 뜨면 “기기 공용 데이터” 정상</div>
  <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">
    <button class="btn" id="ping">/api/kv/get 테스트</button>
    <span class="sub" id="pingMsg"></span>
  </div>
</div>

<div class="card">
  <b>점포 등록</b>
  <div class="row" style="margin-top:10px;">
    <div><input id="sname" placeholder="점포명"></div>
    <div><input id="scode" placeholder="점포코드"></div>
  </div>
  <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
    <button class="btn primary" id="sreg">점포등록</button>
    <span class="sub" id="smsg"></span>
  </div>

  <div class="hr"></div>

  <b>기사 등록</b>
  <div class="row" style="margin-top:10px;">
    <div><input id="dname" placeholder="기사명"></div>
    <div><input id="dphone" placeholder="전화번호"></div>
  </div>
  <div class="row" style="margin-top:10px;">
    <div><input id="dcode" placeholder="기사코드"></div>
    <div>
      <select id="drole">
        <option value="DOMESTIC">국내택배 기사</option>
        <option value="ECONOMY_CVS">반값택배 기사</option>
        <option value="INTERNATIONAL">국제택배 기사</option>
      </select>
    </div>
  </div>
  <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
    <button class="btn primary" id="dreg">기사등록</button>
    <span class="sub" id="dmsg"></span>
  </div>
</div>

<div class="card">
  <b>고객 예약</b>
  <div class="sub">예약번호 생성 → 키오스크에서 예약접수하면 운송장(18자리) 발급</div>

  <div class="row" style="margin-top:10px;">
    <div>
      <label class="sub">서비스</label>
      <select id="type">
        <option value="DOMESTIC">국내택배</option>
        <option value="INTERNATIONAL">국제택배</option>
        <option value="ECONOMY_CVS">반값택배</option>
        <option value="RETURN">반품택배</option>
      </select>
    </div>
    <div>
      <label class="sub">무게(kg)</label>
      <input id="w" type="number" step="0.1" min="0.1" placeholder="예: 1.2">
    </div>
  </div>

  <div class="row" style="margin-top:10px;">
    <div><input id="s_name" placeholder="보내는분 이름"></div>
    <div><input id="s_phone" placeholder="보내는분 전화"></div>
  </div>
  <div style="margin-top:10px;"><input id="s_addr" placeholder="보내는분 주소"></div>

  <div class="row" style="margin-top:10px;">
    <div><input id="r_name" placeholder="받는분 이름"></div>
    <div><input id="r_phone" placeholder="받는분 전화"></div>
  </div>
  <div style="margin-top:10px;"><input id="r_addr" placeholder="받는분/도착점포 주소"></div>

  <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
    <button class="btn primary" id="reserve">예약하기</button>
    <span class="sub" id="rmsg"></span>
  </div>
</div>

</div>

<script type="module">
import * as c from "./client.js";
const $=id=>document.getElementById(id);
c.startClock($("clock"));

$("ping").onclick=async()=>{
  $("pingMsg").textContent="";
  try{
    await c.apiPost("/api/kv/set",{key:"_ping", value:{t:Date.now()}});
    await c.apiGet("/api/kv/get?key=_ping");
    $("pingMsg").innerHTML="<span class='ok'>OK</span>";
  }catch(e){
    $("pingMsg").innerHTML="<span class='err'>실패:</span> "+e.message+" (Netlify Functions/Redirect 확인)";
  }
};

$("sreg").onclick=async()=>{
  $("smsg").textContent="";
  try{
    await c.apiPost("/api/stores/register",{name:$("sname").value.trim(), code:$("scode").value.trim()});
    $("smsg").innerHTML="<span class='ok'>등록됨</span>";
  }catch(e){ $("smsg").innerHTML="<span class='err'>"+e.message+"</span>"; }
};

$("dreg").onclick=async()=>{
  $("dmsg").textContent="";
  try{
    await c.apiPost("/api/couriers/register",{name:$("dname").value.trim(), phone:$("dphone").value.trim(), code:$("dcode").value.trim(), role:$("drole").value});
    $("dmsg").innerHTML="<span class='ok'>등록됨</span>";
  }catch(e){ $("dmsg").innerHTML="<span class='err'>"+e.message+"</span>"; }
};

$("reserve").onclick=async()=>{
  $("rmsg").textContent="";
  try{
    const rec={
      reserveNo: c.make12(),
      waybillNo: null,
      type: $("type").value,
      status: "RESERVED",
      sender:{name:$("s_name").value.trim(),phone:$("s_phone").value.trim(),address:$("s_addr").value.trim()},
      receiver:{name:$("r_name").value.trim(),phone:$("r_phone").value.trim(),address:$("r_addr").value.trim()},
      package:{weightKg:Number($("w").value)},
      storeName: null,
      courier: null,
      events:[{time:new Date().toISOString(), place:"예약", message:"예약이 생성되었습니다"}]
    };
    if(!rec.sender.name||!rec.sender.phone||!rec.sender.address) throw new Error("보내는분 필수");
    if(!rec.receiver.name||!rec.receiver.phone||!rec.receiver.address) throw new Error("받는분/점포 주소 필수");
    if(!rec.package.weightKg || rec.package.weightKg<=0) throw new Error("무게 입력");
    await c.apiPost("/api/reservations/upsert", rec);
    $("rmsg").innerHTML="<span class='ok'>예약완료</span> 예약번호: <span class='mono'>"+rec.reserveNo+"</span>";
  }catch(e){ $("rmsg").innerHTML="<span class='err'>실패:</span> "+e.message; }
};
</script>
</body></html>
