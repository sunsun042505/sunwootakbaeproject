<!doctype html><html lang="ko"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>라벨</title><link rel="stylesheet" href="./style.css">
<style>
#label{width:380px;background:#fff;color:#000;border-radius:16px;padding:14px}
#label h2{margin:0;font-size:16px}
.muted{color:#333;font-size:12px}
.small{font-size:12px}
.rowx{display:flex;justify-content:space-between;gap:10px}
hr{border:none;border-top:1px solid #ddd;margin:10px 0}
</style></head>
<body><div class="wrap">
<div class="topbar">
  <div><div class="title">운송장 라벨</div><div class="sub">build 2025-12-31 14:20:46 KST</div></div>
  <div style="display:flex;gap:10px;flex-wrap:wrap;">
    <button class="btn" onclick="location.href='./index.html'">메인</button>
    <button class="btn primary" onclick="window.print()">인쇄</button>
  </div>
</div>

<div class="card" style="display:flex;justify-content:center;">
  <div id="label">
    <h2>선우택배</h2>
    <div class="muted">운송장번호: <span class="mono" id="wb">-</span></div>
    <hr/>
    <svg id="barcode"></svg>
    <hr/>
    <div class="rowx"><div class="small">접수지점</div><div id="from">-</div></div>
    <div class="rowx"><div class="small">도착/수령</div><div id="to">-</div></div>
    <div class="rowx"><div class="small">주소</div><div id="addr">-</div></div>
    <div class="rowx"><div class="small">무게(kg)</div><div id="w">-</div></div>
  </div>
</div>

<div class="card"><div class="sub" id="msg">-</div></div>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
<script type="module">
import * as c from "./client.js";
const $=id=>document.getElementById(id);
const inv=c.digitsOnly(new URL(location.href).searchParams.get("invoice_no")||"");
if(!inv){ $("msg").innerHTML="<span class='err'>invoice_no 없음</span>"; }
else{
  $("wb").textContent=inv;
  try{
    const rec=await c.apiGet("/api/reservations/byWaybill/"+encodeURIComponent(inv));
    $("from").textContent=rec.storeName || "-";
    $("to").textContent=rec.receiver?.name || "-";
    $("addr").textContent=rec.receiver?.address || "-";
    $("w").textContent=(rec.package?.weightKg ?? "-");
    JsBarcode("#barcode", String(inv), {format:"CODE128",displayValue:true,fontSize:12,height:60,margin:0});
    $("msg").innerHTML="<span class='ok'>라벨 준비됨</span>";
  }catch(e){
    $("msg").innerHTML="<span class='err'>서버에서 운송장 찾기 실패</span>";
  }
}
</script>
</body></html>
