<!doctype html><html lang="ko"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>배송조회</title><link rel="stylesheet" href="./style.css"></head>
<body><div class="wrap">
<div class="topbar">
  <div><div class="title">배송조회</div><div class="sub">build 2025-12-31 14:20:46 KST</div></div>
  <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
    <button class="btn" onclick="location.href='./index.html'">메인</button>
  </div>
</div>

<div class="card">
  <div class="row">
    <div><input id="inv" class="mono" placeholder="81xxxxxxxxxxxxxxxx"></div>
    <div><button class="btn primary" id="go" style="width:100%;">조회</button></div>
  </div>
  <div class="sub" id="msg" style="margin-top:10px;"></div>
</div>

<div class="card" id="res" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
    <b>조회 결과</b><span class="pill mono" id="wb">-</span>
  </div>
  <div class="hr"></div>
  <div class="row">
    <div><div class="sub">서비스</div><div id="svc" style="font-weight:900;"></div></div>
    <div><div class="sub">배송사</div><div id="carrier" style="font-weight:900;"></div></div>
  </div>
  <div class="row" style="margin-top:10px;">
    <div><div class="sub">보내는분</div><div id="sender" style="font-weight:900;"></div></div>
    <div><div class="sub">받는분</div><div id="receiver" style="font-weight:900;"></div></div>
  </div>
  <div class="row" style="margin-top:10px;">
    <div><div class="sub">무게</div><div id="w" style="font-weight:900;"></div></div>
    <div><div class="sub">상태</div><div id="status" style="font-weight:900;"></div></div>
  </div>
  <div class="hr"></div>
  <b>배송흐름</b>
  <div id="tl"></div>
</div>

<script type="module">
import * as c from "./client.js";
const $=id=>document.getElementById(id);

function typeLabel(t){ return ({DOMESTIC:"국내택배",INTERNATIONAL:"국제택배",ECONOMY_CVS:"반값택배",RETURN:"반품택배"})[t]||t||"-"; }
function carrierLabel(t){
  if(t==="ECONOMY_CVS") return "선우네트웍스";
  if(t==="INTERNATIONAL") return "네버랩인터내셔널에어포트(주)(인천국제공항)";
  return "선우택배";
}

async function run(inv, push){
  $("msg").textContent="";
  inv=c.digitsOnly(inv);
  if(inv.length!==18){ $("msg").innerHTML="<span class='err'>18자리 숫자만</span>"; return; }
  if(push){
    const u=new URL(location.href); u.searchParams.set("invoice_no",inv); history.replaceState(null,"",u.toString());
  }
  $("inv").value=inv;
  try{
    const rec=await c.apiGet("/api/reservations/byWaybill/"+encodeURIComponent(inv));
    $("res").style.display="";
    $("wb").textContent=rec.waybillNo;
    $("svc").textContent=typeLabel(rec.type);
    $("carrier").textContent=carrierLabel(rec.type);
    $("sender").textContent=(rec.sender?.name||"-")+" ("+(rec.sender?.phone||"-")+")";
    $("receiver").textContent=(rec.receiver?.name||"-")+" ("+(rec.receiver?.phone||"-")+")";
    $("w").textContent=(rec.package?.weightKg ?? "-")+" kg";
    $("status").textContent=rec.status || "-";
    const tl=$("tl"); tl.innerHTML="";
    (rec.events||[]).forEach(e=>{
      tl.innerHTML += `<div class="card" style="margin-top:10px;background:rgba(0,0,0,.18)">
        <div style="font-weight:900">${e.place} ${e.message}</div>
        <div class="sub">${e.time}</div>
      </div>`;
    });
  }catch(e){
    $("res").style.display="none";
    $("msg").innerHTML="<span class='err'>등록된 운송장이 아님</span> (발급 후 바로 조회해봐)";
  }
}

$("go").onclick=()=>run($("inv").value,true);
const q=new URL(location.href).searchParams.get("invoice_no"); if(q) run(q,false);
</script>
</body></html>
